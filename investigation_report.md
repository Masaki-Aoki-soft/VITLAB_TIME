# 信号エッジが全て通らない原因の調査結果

## 1. 主な問題点

### 問題1: MAX_SIGNALSの制限
- `MAX_SIGNALS = 9`に設定されているが、`signal_inf.csv`には**37個の信号エッジ**が定義されている
- そのため、最初の9個の信号エッジしか読み込まれない
- 残りの28個の信号エッジは無視される

### 問題2: 信号エッジが経路に追加されても、グラフのエッジとして存在しない可能性
- `findPathThroughSignalsInOrder`関数で、信号エッジを経路に追加している（969行目）
- しかし、その信号エッジが実際にグラフのエッジとして存在するか確認していない
- `dijkstraWithoutSignalWait`で信号エッジのノード（from/to）に到達できても、その信号エッジ自体がグラフに接続されていない可能性がある

### 問題3: 信号エッジのノードに到達できない場合の処理
- 信号エッジのfromノードに到達できない場合、toノードを試す（965-976行目）
- しかし、どちらも到達できない場合、経路生成が失敗する
- この場合、その組み合わせの経路は生成されない

### 問題4: 経路に信号エッジが含まれているかの検証不足
- 経路生成後、経路に信号エッジが実際に含まれているか確認している（1075-1090行目）
- しかし、この検証は経路が生成された後にのみ実行される
- 経路生成が失敗した場合（信号エッジに到達できない場合）、この検証は実行されない

## 2. 具体的な原因

### 原因1: 信号エッジの読み込み制限
- `signal_inf.csv`には37個の信号エッジがあるが、`MAX_SIGNALS=9`のため、最初の9個しか読み込まれない
- 残りの28個の信号エッジは無視されるため、それらを通る経路は生成されない

### 原因2: 信号エッジがグラフに接続されていない
- `findPathThroughSignalsInOrder`関数で、信号エッジを経路に追加しているが、その信号エッジが実際にグラフのエッジとして存在するか確認していない
- 信号エッジのノード（from/to）に到達できても、その信号エッジ自体がグラフに接続されていない場合、経路は不完全になる

### 原因3: 信号エッジのノードに到達できない
- 信号エッジのfromノードに到達できない場合、toノードを試すが、どちらも到達できない場合、経路生成が失敗する
- この場合、その組み合わせの経路は生成されない

## 3. 解決策

### 解決策1: MAX_SIGNALSを増やす
- `MAX_SIGNALS`を37以上に増やす
- または、`signal_inf.csv`から全ての信号エッジを読み込むようにする

### 解決策2: 信号エッジがグラフに接続されているか確認
- 信号エッジを経路に追加する前に、その信号エッジが実際にグラフのエッジとして存在するか確認する
- 存在しない場合、その信号エッジを通る経路は生成しない

### 解決策3: 信号エッジのノードに到達できない場合の処理を改善
- 信号エッジのノードに到達できない場合、別の経路を試す
- または、その信号エッジを通らない経路を生成する

### 解決策4: 経路生成後の検証を強化
- 経路生成後、経路に全ての必要な信号エッジが含まれているか確認する
- 含まれていない場合、その経路を破棄する

## 4. 調査結果の詳細

### signal_inf.csvの内容
- 37個の信号エッジが定義されている（ヘッダー含む）
- フォーマット: `node1,node2,cycle,green,phase`
- 例: `17,190,59.65,30.7,22.45`

### result.csvの内容
- 信号エッジの多くが`result.csv`に存在している
- フォーマット: `from,to,weight`
- 例: `17,190,68.57580726`

### コードの問題点
1. `MAX_SIGNALS=9`のため、37個の信号エッジのうち9個しか読み込まれない
2. 信号エッジが経路に追加されても、そのエッジが実際にグラフのエッジとして存在するか確認していない
3. 信号エッジのノードに到達できない場合、経路生成が失敗する

